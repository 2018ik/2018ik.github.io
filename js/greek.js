const eph1 = ["Παῦλος ἀπόστολος Χριστοῦ Ἰησοῦ διὰ θελήματος θεοῦ τοῖς ἁγίοις τοῖς οὖσιν ἐν Ἐφέσῳ καὶ πιστοῖς ἐν Χριστῷ Ἰησοῦ [Eph 1:1 MGNT]", "χάρις ὑμῖν καὶ εἰρήνη ἀπὸ θεοῦ πατρὸς ἡμῶν καὶ κυρίου Ἰησοῦ Χριστοῦ [Eph 1:2 MGNT]", "εὐλογητὸς ὁ θεὸς καὶ πατὴρ τοῦ κυρίου ἡμῶν Ἰησοῦ Χριστοῦ ὁ εὐλογήσας ἡμᾶς ἐν πάσῃ εὐλογίᾳ πνευματικῇ ἐν τοῖς ἐπουρανίοις ἐν Χριστῷ [Eph 1:3 MGNT]", "καθὼς ἐξελέξατο ἡμᾶς ἐν αὐτῷ πρὸ καταβολῆς κόσμου εἶναι ἡμᾶς ἁγίους καὶ ἀμώμους κατενώπιον αὐτοῦ ἐν ἀγάπῃ [Eph 1:4 MGNT]", "προορίσας ἡμᾶς εἰς υἱοθεσίαν διὰ Ἰησοῦ Χριστοῦ εἰς αὐτόν κατὰ τὴν εὐδοκίαν τοῦ θελήματος αὐτοῦ [Eph 1:5 MGNT]", "εἰς ἔπαινον δόξης τῆς χάριτος αὐτοῦ ἧς ἐχαρίτωσεν ἡμᾶς ἐν τῷ ἠγαπημένῳ [Eph 1:6 MGNT]", "ἐν ᾧ ἔχομεν τὴν ἀπολύτρωσιν διὰ τοῦ αἵματος αὐτοῦ τὴν ἄφεσιν τῶν παραπτωμάτων κατὰ τὸ πλοῦτος τῆς χάριτος αὐτοῦ [Eph 1:7 MGNT]", "ἧς ἐπερίσσευσεν εἰς ἡμᾶς ἐν πάσῃ σοφίᾳ καὶ φρονήσει [Eph 1:8 MGNT]", "γνωρίσας ἡμῖν τὸ μυστήριον τοῦ θελήματος αὐτοῦ κατὰ τὴν εὐδοκίαν αὐτοῦ ἣν προέθετο ἐν αὐτῷ [Eph 1:9 MGNT]", "εἰς οἰκονομίαν τοῦ πληρώματος τῶν καιρῶν ἀνακεφαλαιώσασθαι τὰ πάντα ἐν τῷ Χριστῷ τὰ ἐπὶ τοῖς οὐρανοῖς καὶ τὰ ἐπὶ τῆς γῆς ἐν αὐτῷ [Eph 1:10 MGNT]", "ἐν ᾧ καὶ ἐκληρώθημεν προορισθέντες κατὰ πρόθεσιν τοῦ τὰ πάντα ἐνεργοῦντος κατὰ τὴν βουλὴν τοῦ θελήματος αὐτοῦ [Eph 1:11 MGNT]", "εἰς τὸ εἶναι ἡμᾶς εἰς ἔπαινον δόξης αὐτοῦ τοὺς προηλπικότας ἐν τῷ Χριστῷ [Eph 1:12 MGNT]", "ἐν ᾧ καὶ ὑμεῖς ἀκούσαντες τὸν λόγον τῆς ἀληθείας τὸ εὐαγγέλιον τῆς σωτηρίας ὑμῶν ἐν ᾧ καὶ πιστεύσαντες ἐσφραγίσθητε τῷ πνεύματι τῆς ἐπαγγελίας τῷ ἁγίῳ [Eph 1:13 MGNT]", "ὅ ἐστιν ἀρραβὼν τῆς κληρονομίας ἡμῶν εἰς ἀπολύτρωσιν τῆς περιποιήσεως εἰς ἔπαινον τῆς δόξης αὐτοῦ [Eph 1:14 MGNT]", "διὰ τοῦτο κἀγώ ἀκούσας τὴν καθ ̓ὑμᾶς πίστιν ἐν τῷ κυρίῳ Ἰησοῦ καὶ τὴν ἀγάπην τὴν εἰς πάντας τοὺς ἁγίους [Eph 1:15 MGNT]", "οὐ παύομαι εὐχαριστῶν ὑπὲρ ὑμῶν μνείαν ποιούμενος ἐπὶ τῶν προσευχῶν μου [Eph 1:16 MGNT]", "ἵνα ὁ θεὸς τοῦ κυρίου ἡμῶν Ἰησοῦ Χριστοῦ ὁ πατὴρ τῆς δόξης δώῃ ὑμῖν πνεῦμα σοφίας καὶ ἀποκαλύψεως ἐν ἐπιγνώσει αὐτοῦ [Eph 1:17 MGNT]", "πεφωτισμένους τοὺς ὀφθαλμοὺς τῆς καρδίας ὑμῶν εἰς τὸ εἰδέναι ὑμᾶς τίς ἐστιν ἡ ἐλπὶς τῆς κλήσεως αὐτοῦ τίς ὁ πλοῦτος τῆς δόξης τῆς κληρονομίας αὐτοῦ ἐν τοῖς ἁγίοις [Eph 1:18 MGNT]", "καὶ τί τὸ ὑπερβάλλον μέγεθος τῆς δυνάμεως αὐτοῦ εἰς ἡμᾶς τοὺς πιστεύοντας κατὰ τὴν ἐνέργειαν τοῦ κράτους τῆς ἰσχύος αὐτοῦ [Eph 1:19 MGNT]", "ἣν ἐνήργησεν ἐν τῷ Χριστῷ ἐγείρας αὐτὸν ἐκ νεκρῶν καὶ καθίσας ἐν δεξιᾷ αὐτοῦ ἐν τοῖς ἐπουρανίοις [Eph 1:20 MGNT]", "ὑπεράνω πάσης ἀρχῆς καὶ ἐξουσίας καὶ δυνάμεως καὶ κυριότητος καὶ παντὸς ὀνόματος ὀνομαζομένου οὐ μόνον ἐν τῷ αἰῶνι τούτῳ ἀλλὰ καὶ ἐν τῷ μέλλοντι [Eph 1:21 MGNT]", "καὶ πάντα ὑπέταξεν ὑπὸ τοὺς πόδας αὐτοῦ καὶ αὐτὸν ἔδωκεν κεφαλὴν ὑπὲρ πάντα τῇ ἐκκλησίᾳ [Eph 1:22 MGNT]", "ἥτις ἐστὶν τὸ σῶμα αὐτοῦ τὸ πλήρωμα τοῦ τὰ πάντα ἐν πᾶσιν πληρουμένου [Eph 1:23 MGNT]"];

const wordMap = {"αἰῶνι": "N- ----DSM-","αἵματος": "N- ----GSN-","αὐτοῦ": "RP ----GSM-","αὐτὸν": "RP ----ASM-","αὐτόν": "RP ----ASM-","αὐτῷ": "RP ----DSN-","βουλὴν": "N- ----ASF-","γνωρίσας": "V- -AAPNSM-","γῆς": "N- ----GSF-","δεξιᾷ": "A- ----DSF-","διὰ": "P- --------","δυνάμεως": "N- ----GSF-","δόξης": "N- ----GSF-","δώῃ": "V- 3AAS-S--","εἰδέναι": "V- -XAN----","εἰρήνη": "N- ----NSF-","εἰς": "P- --------","εἶναι": "V- -PAN----","εὐαγγέλιον": "N- ----ASN-","εὐδοκίαν": "N- ----ASF-","εὐλογητὸς": "A- ----NSM-","εὐλογήσας": "V- -AAPNSM-","εὐλογίᾳ": "N- ----DSF-","εὐχαριστῶν": "V- -PAPNSM-","θελήματος": "N- ----GSN-","θεοῦ": "N- ----GSM-","θεὸς": "N- ----NSM-","καθίσας": "V- -AAPNSM-","καθὼς": "C- --------","καθ": "P- --------","καιρῶν": "N- ----GPM-","καρδίας": "N- ----APF-","καταβολῆς": "N- ----GSF-","κατενώπιον": "P- --------","κατὰ": "P- --------","καὶ": "C- --------","κεφαλὴν": "N- ----ASF-","κληρονομίας": "N- ----GSF-","κλήσεως": "N- ----GSF-","κράτους": "N- ----GSN-","κυριότητος": "N- ----GSF-","κυρίου": "N- ----GSM-","κυρίῳ": "N- ----DSM-","κἀγώ": "RP ----NS--","κόσμου": "N- ----GSM-","λόγον": "N- ----ASM-","μνείαν": "N- ----ASF-","μου": "RP ----GS--","μυστήριον": "N- ----ASN-","μέγεθος": "N- ----NSN-","μέλλοντι": "V- -PAPDSM-","μόνον": "A- ----ASN-","νεκρῶν": "A- ----GPM-","οἰκονομίαν": "N- ----ASF-","οὐ": "D- --------","οὐρανοῖς": "N- ----DPM-","οὖσιν": "V- -PAPDPM-","παντὸς": "A- ----GSN-","παραπτωμάτων": "N- ----GPN-","πατρὸς": "N- ----GSM-","πατὴρ": "N- ----NSM-","παύομαι": "V- 1PMI-S--","παῦλος": "N- ----NSM-","περιποιήσεως": "N- ----GSF-","πεφωτισμένους": "V- -XPPAPM-","πιστεύοντας": "V- -PAPAPM-","πιστεύσαντες": "V- -AAPNPM-","πιστοῖς": "A- ----DPM-","πληρουμένου": "V- -PMPGSM-","πληρώματος": "N- ----GSN-","πλοῦτος": "N- ----ASN-","πλήρωμα": "N- ----ASN-","πνευματικῇ": "A- ----DSF-","πνεύματι": "N- ----DSN-","πνεῦμα": "N- ----ASN-","ποιούμενος": "V- -PMPNSM-","προηλπικότας": "V- -XAPAPM-","προορισθέντες": "V- -APPNPM-","προορίσας": "V- -AAPNSM-","προσευχῶν": "N- ----GPF-","προέθετο": "V- 3AMI-S--","πρὸ": "P- --------","πρόθεσιν": "N- ----ASF-","πάντα": "A- ----APN-","πάντας": "A- ----APM-","πάσης": "A- ----GSF-","πάσῃ": "A- ----DSF-","πίστιν": "N- ----ASF-","πόδας": "N- ----APM-","πᾶσιν": "A- ----DPN-","σοφίας": "N- ----GSF-","σοφίᾳ": "N- ----DSF-","σωτηρίας": "N- ----GSF-","σῶμα": "N- ----NSN-","τοὺς": "RA ----APM-","τούτῳ": "RD ----DSM-","τοῖς": "RA ----DPM-","τοῦ": "RA ----GSN-","τοῦτο": "RD ----ASN-","τὰ": "RA ----APN-","τὴν": "RA ----ASF-","τί": "RI ----ASN-","τίς": "RI ----NSF-","τὸ": "RA ----ASN-","τὸν": "RA ----ASM-","τῆς": "RA ----GSF-","τῇ": "RA ----DSF-","τῶν": "RA ----GPM-","τῷ": "RA ----DSN-","υἱοθεσίαν": "N- ----ASF-","φρονήσει": "N- ----DSF-","χριστοῦ": "N- ----GSM-","χριστῷ": "N- ----DSM-","χάρις": "N- ----NSF-","χάριτος": "N- ----GSF-","ἀγάπην": "N- ----ASF-","ἀγάπῃ": "N- ----DSF-","ἀκούσαντες": "V- -AAPNPM-","ἀκούσας": "V- -AAPNSM-","ἀληθείας": "N- ----GSF-","ἀλλὰ": "C- --------","ἀμώμους": "A- ----APM-","ἀνακεφαλαιώσασθαι": "V- -AMN----","ἀποκαλύψεως": "N- ----GSF-","ἀπολύτρωσιν": "N- ----ASF-","ἀπὸ": "P- --------","ἀπόστολος": "N- ----NSM-","ἀρραβὼν": "N- ----NSM-","ἀρχῆς": "N- ----GSF-","ἁγίοις": "A- ----DPM-","ἁγίους": "A- ----APM-","ἁγίῳ": "A- ----DSN-","ἄφεσιν": "N- ----ASF-","ἐγείρας": "V- -AAPNSM-","ἐκ": "P- --------","ἐκκλησίᾳ": "N- ----DSF-","ἐκληρώθημεν": "V- 1API-P--","ἐλπὶς": "N- ----NSF-","ἐν": "P- --------","ἐνεργοῦντος": "V- -PAPGSN-","ἐνέργειαν": "N- ----ASF-","ἐνήργησεν": "V- 3AAI-S--","ἐξελέξατο": "V- 3AMI-S--","ἐξουσίας": "N- ----APF-","ἐπαγγελίας": "N- ----GSF-","ἐπερίσσευσεν": "V- 3AAI-S--","ἐπιγνώσει": "N- ----DSF-","ἐπουρανίοις": "A- ----DPN-","ἐπὶ": "P- --------","ἐστιν": "V- 3PAI-S--","ἐστὶν": "V- 3PAI-S--","ἐσφραγίσθητε": "V- 2API-P--","ἐφέσῳ": "N- ----DSF-","ἐχαρίτωσεν": "V- 3AAI-S--","ἔδωκεν": "V- 3AAI-S--","ἔπαινον": "N- ----ASM-","ἔχομεν": "V- 1PAI-P--","ἠγαπημένῳ": "V- -XPPDSM-","ἡ": "RA ----NSF-","ἡμᾶς": "RP ----AP--","ἡμῖν": "RP ----DP--","ἡμῶν": "RP ----GP--","ἣν": "RR ----ASF-","ἥτις": "RR ----NSF-","ἧς": "RR ----GSF-","ἰησοῦ": "N- ----GSM-","ἰσχύος": "N- ----GSF-","ἵνα": "C- --------","ὀνομαζομένου": "V- -PPPGSN-","ὀνόματος": "N- ----GSN-","ὀφθαλμοὺς": "N- ----APM-","ὁ": "RA ----NSM-","ὅ": "RR ----NSN-","ὑμεῖς": "RP ----NP--","ὑμᾶς": "RP ----AP--","ὑμῖν": "RP ----DP--","ὑμῶν": "RP ----GP--","ὑπερβάλλον": "V- -PAPASN-","ὑπεράνω": "P- --------","ὑπὲρ": "P- --------","ὑπέταξεν": "V- 3AAI-S--","ὑπὸ": "P- --------","ᾧ": "RR ----DSM-"}

const partOfSpeechMap = {
    "A-": "adjective",
    "C-": "conjunction",
    "D-": "adverb",
    "I-": "interjection",
    "N-": "noun",
    "P-": "preposition",
    "RA": "definite article",
    "RD": "demonstrative pronoun",
    "RI": "interrogative/indefinite pronoun",
    "RP": "personal pronoun",
    "RR": "relative pronoun",
    "V-": "verb",
    "X-": "particle"
};

const tenseMap = {
    "P": "present", 
    "I":"imperfect", 
    "F":"future", 
    "A":"aorist", 
    "X":"perfect", 
    "Y":"pluperfect"
};

const voiceMap = {
    "A": "active",
    "M": "middle",
    "P": "passive"
};

const moodMap = {
    "I": "indicative",
    "D": "imperative",
    "S": "subjunctive",
    "O": "optative",
    "N": "infinitive",
    "P": "participle"
};

const caseMap = {
    "N": "nominative",
    "G": "genitive",
    "D": "dative",
    "A": "accusative"
};

const numberMap = {
    "S": "singular",
    "P": "plural"
};

const genderMap = {
    "M": "masculine",
    "F": "feminine",
    "N": "neuter"
};

const eph1VersesWithParticiples = [1,3,5,6,9,11,12,13,15,16,18,19,20,21,23];
const eph1VersesWithNouns = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];
var currentWord = "";

const grammarSelector = document.getElementById('grammarSelector');

const partOfSpeechSelector = document.getElementById('partOfSpeechSelector');
const personSelector = document.getElementById('personSelector');
const tenseSelector = document.getElementById('tenseSelector');
const voiceSelector = document.getElementById('voiceSelector');
const moodSelector = document.getElementById('moodSelector');
const numberSelector = document.getElementById('numberSelector');
const genderSelector = document.getElementById('genderSelector');
const degreeSelector = document.getElementById('degreeSelector');

const partOfSpeechForm = document.getElementById('partOfSpeechForm');
const personForm = document.getElementById('personForm');
const tenseForm = document.getElementById('tenseForm');
const voiceForm = document.getElementById('voiceForm');
const moodForm = document.getElementById('moodForm');
const caseForm = document.getElementById('caseForm');
const numberForm = document.getElementById('numberForm');
const genderForm = document.getElementById('genderForm');

const submitButton = document.getElementById('submitButton');
const errorText = document.getElementById('errorText');
const rewardText = document.getElementById('rewardText');

document.addEventListener("DOMContentLoaded", function() {
    function updateForms() {
        let value = grammarSelector.value;
        
        if (value === 'noun') {
            partOfSpeechSelector.value = value;
            caseForm.style.display = ''
            numberForm.style.display = ''
            genderForm.style.display = ''
            partOfSpeechForm.style.display = 'none';
            personForm.style.display = 'none';
            tenseForm.style.display = 'none';
            voiceForm.style.display = 'none';
            moodForm.style.display = 'none';
        } else if (value === 'participle') {
            partOfSpeechSelector.value = 'verb';
            moodSelector.value = 'participle';
            tenseForm.style.display = '';
            voiceForm.style.display = '';
            caseForm.style.display = ''
            numberForm.style.display = ''
            genderForm.style.display = ''
            moodForm.style.display = 'none';
            personForm.style.display = 'none';
            partOfSpeechForm.style.display = 'none';
        } else {
            // For any other value or if nothing is selected, show all
            if (partOfSpeechSelector.value == "noun") {
                caseForm.style.display = ''
                numberForm.style.display = ''
                genderForm.style.display = ''
                partOfSpeechForm.style.display = '';
                personForm.style.display = 'none';
                tenseForm.style.display = 'none';
                voiceForm.style.display = 'none';
                moodForm.style.display = 'none';
            } else if (partOfSpeechSelector.value == "verb") {
                moodSelector.value = 'participle';
                tenseForm.style.display = '';
                voiceForm.style.display = '';
                caseForm.style.display = ''
                numberForm.style.display = ''
                genderForm.style.display = ''
                partOfSpeechForm.style.display = '';
                moodForm.style.display = '';
                personForm.style.display = 'none';
            } else {
                partOfSpeechForm.style.display = '';
                personForm.style.display = '';
                tenseForm.style.display = '';
                voiceForm.style.display = '';
                moodForm.style.display = '';
                caseForm.style.display = ''
                numberForm.style.display = ''
                genderForm.style.display = ''
            }
        }
    }

    // Initialize visibility based on the initial value
    updateForms();

    // Update visibility on change
    grammarSelector.addEventListener('change', () => {
        updateForms();
        displayVerse();
    });

    partOfSpeechSelector.addEventListener('change', updateForms);
    submitButton.addEventListener('click', checkWord);

    document.addEventListener('keydown', function(event) {
        if (event.code === 'Space' || event.code === 'Enter') {
            checkWord();
        }
    });

    window.onload = function() {
        displayVerse();
    }
});

    

function displayVerse() {
    let validVerses = [];
    let grammar = document.querySelector('#grammarSelector').value;
    console.log(grammar);
    if (grammar === "all") {
        validVerses = [...new Set([...eph1VersesWithParticiples, ...eph1VersesWithNouns])];
    } else if (grammar == "participle") {
        validVerses = eph1VersesWithParticiples;
    } else {
        validVerses = eph1VersesWithNouns;
    }
    console.log(validVerses);
    const randomIndex = Math.floor(Math.random() * validVerses.length);
    let line = eph1[validVerses[randomIndex]-1];
    let verseParts = line.split(" [");
    let verse = verseParts[0];
    let reference = verseParts[1].split(" M")[0];
    let words = verse.split(" ");

    validWords = []
    if (grammar === "all") {
        validWords = [...findNouns(words), ...findParticiples(words)];
    } else if (grammar == "participle") {
        validWords = findParticiples(words);
    } else {
        validWords = findNouns(words);
    }

    let chosenIndex = validWords[Math.floor(Math.random() * validWords.length)];
    currentWord = words[chosenIndex];
    words[chosenIndex] = `<b>${words[chosenIndex]}</b>`
    // Join the words back into a string
    let modifiedVerse = words.join(" ");
    
    // Display the verse
    document.getElementById('greekVerse').innerHTML = modifiedVerse;
    document.getElementById('greekVerseRef').textContent = reference;
}

function findParticiples(words) {
    participles = [];
    // Loop through words to find and bold the participles
    for (let i = 0; i < words.length; i++) {
        let word = words[i];
        let parsing = wordMap[word.toLowerCase()];
        if (parsing && parsing.split(" ")[1][3] === 'P') {
            participles.push(i);
        }
    }
    return participles;
}

function findNouns(words) {
    nouns = []
    // Loop through words to find and bold the participles
    for (let i = 0; i < words.length; i++) {
        let word = words[i];
        let parsing = wordMap[word.toLowerCase()];
        if (parsing && parsing.split(" ")[0] === 'N-') {
            nouns.push(i);
        }
    }
    return nouns;
}

function checkWord() {
    if (submitButton.innerText === "Continue") {
        displayVerse();
        errorText.style.display = "none";
        rewardText.style.display = "none";
        submitButton.innerText = "Submit";
        return;
    }
    // Format for Noun: N- ----GSF-
    // Verb: V- -PPPGSN-
    let parsing = wordMap[currentWord.toLowerCase()].split(" ");
    let wrong = false;
    let correctAnswer = "";

    part1 = parsing[0]
    let partOfSpeech = partOfSpeechMap[part1];
    correctAnswer += partOfSpeech;
    if (partOfSpeechSelector.value !== partOfSpeech) {
        wrong = true;
    }
    
    part2 = parsing[1]
    // Check person (don't need this right now)
    // part2[0]
    if (part2[1] != "-") {
        let tense = tenseMap[part2[1]];
        correctAnswer += " " + tense;
        if (tenseSelector.value !== tense) {
            wrong = true;
        }
    }

    if (part2[2] != "-") {
        let voice = voiceMap[part2[2]];
        correctAnswer += " " + voice;
        if (voiceSelector.value !== voice) {
            wrong = true;
        }
    }
    // Check mood
    if (part2[3] != "-") {
        let mood = moodMap[part2[3]];
        correctAnswer += " " + mood;
        if (moodSelector.value !== mood) {
            wrong = true;
        }
    }
    // Check case
    if (part2[4] != "-") {
        let caseq = caseMap[part2[4]];
        correctAnswer += " " + caseq;
        if (caseSelector.value !== caseq) {
            wrong = true;
        }
    }
    if (part2[5] != "-") {
        let number = numberMap[part2[5]];
        correctAnswer += " " + number;
        if (numberSelector.value !== number) {
            wrong = true;
        }
    }
    if (part2[6] != "-") {
        let gender = genderMap[part2[6]];
        correctAnswer += " " + gender;
        if (genderSelector.value !== gender) {
            wrong = true;
        }
    }

    if (wrong) {
        errorText.innerText = "Wrong! Correct answer: " + correctAnswer;
        errorText.style.display = "";
        rewardText.style.display = "none";
    } else {
        rewardText.innerText = "You got it!";
        rewardText.style.display = "";
        errorText.style.display = "none";
    }
    submitButton.innerText = "Continue";
}